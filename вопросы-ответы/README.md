# Перечень вопросов и ответов по CPI
Он же FAQ CPI. Двуязычный (англ+рус) писать нет желания, проще "для своих" по-русски. АргхЪ!

<iliya.kuznetsov@gmail.com> 2020-09-29-002

## Архитектура в целом

### Контейнеры и OSGI

## Компиляция IFLOW в Blueprint

## Расписания

### Как запланировать задание в последний день месяца?
Красивый способ - свой адаптер с произвольным крон-расписанием.
Некрасивые:
* Планировать задание на следующий месяц руками
* Сделать 12 таймеров-сендеров и планировать раз в год руками
* Запускаться каждый день и в скрипте/роутере смотреть не последний ли

### Если несколько рабочих нод то сообщение по таймеру стартует везде сразу, как с этим бороться в мониторинге?
В октябре 2020 появился статус DISCARDED для тех рабочих нод где не запускалось реально.

## Адаптеры

### Как прочитать/удалить файл с SFTP по запросу из CPI?

### Как сделать асинхронный HTTP Sender/Consumer?
Про Receiver/Producer речь не идёт, нам нужен ответ веб-сервера чтобы код возврата проанализировать.

Штатный веб-сервер на стороне CPI который является сервлетом в /http/ заточен на MEP=InOut и неявно пробрасывает последнее сообщение в маршруте обратно вызывающей стороне, поэтому если у нас длинная-длинная обработка начинающаяся от HTTPS Sender канала то пока всё не закончится, вызывающий клиент не получит никакого ответа.

Такое поведение иногда неудобно, например - хотим снаружи в CPI передать какой-то вход, быстро проверить его и выдать статус про принято оно в работу или нет (202 Accepted или даже 208 Already Reported и 400 Bad Request для ошибки).

Для SOAP мы можем реализовать явный асинхронный сервис в CPI (есть и InOut и InOnly), почему в HTTP такого нет?

Хороший способ это написать свой адаптер-сервлет в /customhttp/.
Костыли следующие:
* Сделать мостик из InOut в InOnly.
* Промежуточное хранилище в DataStore или в JMS или даже в файле
* ...

